<div class="bg-[#181c23] border border-white/10 rounded-b-lg p-6">
  <label class="block text-sm font-medium text-white mb-4">Videos de YouTube</label>

  @if (loading) {
    <div class="flex justify-center items-center py-8">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  } @else {
    <div class="space-y-4 mb-6">
      @for (video of videos; track video.id) {
        <mat-card class="bg-black/40">
          <mat-card-content class="flex items-center gap-4 p-3">
            <div class="flex-1 overflow-hidden">
              <p class="text-white truncate" title="{{ video.url }}">{{ video.url }}</p>
              <p class="text-gray-400 text-sm mt-2" *ngIf="video.description">{{ video.description }}</p>
              <div class="flex flex-wrap gap-2 mt-2" *ngIf="video.features?.length">
                <mat-chip-grid>
                  <mat-chip *ngFor="let feature of video.features">{{ feature }}</mat-chip>
                </mat-chip-grid>
              </div>
            </div>
            <button mat-icon-button color="warn" (click)="handleRemoveVideo(video.id)">
              <i-lucide name="x" class="w-5 h-5"></i-lucide>
            </button>
          </mat-card-content>
        </mat-card>
      }
    </div>
  }

  <form [formGroup]="videoForm" (ngSubmit)="handleAddVideo()" class="flex flex-col gap-4 items-start">
    <mat-form-field appearance="outline" class="w-full flex-1">
      <mat-label>URL de YouTube</mat-label>
      <input matInput formControlName="newVideo" placeholder="https://www.youtube.com/watch?v=...">
      @if (videoForm.get('newVideo')?.hasError('pattern')) {
        <mat-error>La URL no parece ser un video de YouTube válido.</mat-error>
      }
    </mat-form-field>
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Descripción del video</mat-label>
      <textarea matInput formControlName="description" rows="2" placeholder="Breve descripción del video..."></textarea>
    </mat-form-field>
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Características destacadas</mat-label>
      <mat-chip-grid #chipGrid>
        <mat-chip *ngFor="let feature of features; let i = index" [removable]="true" (removed)="removeFeature(i)">
          {{ feature }}
          <button matChipRemove><i-lucide name="x" class="w-3 h-3"></i-lucide></button>
        </mat-chip>
        <input
          placeholder="Nueva característica"
          [matChipInputFor]="chipGrid"
          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
          [matChipInputAddOnBlur]="true"
          (matChipInputTokenEnd)="addFeature($event)"
          class="bg-transparent text-white placeholder-gray-400"
        />
      </mat-chip-grid>
    </mat-form-field>
    <button mat-flat-button color="primary" type="submit" [disabled]="videoForm.invalid" class="h-[52px] !px-5">
      <div class="flex items-center gap-2">
        <i-lucide name="plus" class="w-5 h-5"></i-lucide>
        Agregar
      </div>
    </button>
  </form>
  <p class="text-xs text-gray-400 mt-2">Pega la URL completa del video de YouTube.</p>
</div>
